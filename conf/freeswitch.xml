<?xml version="1.0"?>
<document type="freeswitch/xml">

<section name="configuration">

<configuration name="switch.conf">
  <settings>
    <param name="colorize-console" value="true"/>
    <param name="max-sessions" value="10000"/>
    <param name="sessions-per-second" value="1000"/>
    <param name="loglevel" value="debug"/>
    <param name="event-heartbeat-interval" value="1"/>
  </settings>
</configuration>

<configuration name="modules.conf">
  <modules>
    <load module="mod_console"/>
    <load module="mod_syslog"/>
    <load module="mod_event_socket"/>
    <load module="mod_sofia"/>
    <load module="mod_dialplan_xml"/>
    <load module="mod_dptools"/>
    <load module="mod_commands"/>
    <load module="mod_sndfile"/>
    <load module="mod_opus"/>
  </modules>
</configuration>

<configuration name="opus.conf">
  <settings>
    <param name="use-vbr" value="1"/>
    <param name="use-dtx" value="0"/>
    <param name="complexity" value="10"/>
    <param name="maxaveragebitrate" value="14400"/>
    <param name="maxplaybackrate" value="8000"/>
    <param name="packet-loss-percent" value="15"/>
    <param name="keep-fec-enabled" value="1"/>
    <param name="use-jb-lookahead" value="1"/>
    <param name="advertise-useinbandfec" value="1"/>
  </settings>
</configuration>

<configuration name="console.conf">
  <mappings>
    <map name="all" value="console,debug,info,notice,warning,err,crit,alert"/>
  </mappings>
  <settings>
    <param name="colorize" value="true"/>
    <param name="loglevel" value="console"/>
  </settings>
</configuration>

<configuration name="syslog.conf">
  <settings>
    <param name="facility" value="user"/>
    <param name="ident" value="freeswitch"/>
    <param name="loglevel" value="debug"/>
    <param name="uuid" value="true"/>
  </settings>
</configuration>

<configuration name="event_socket.conf">
  <settings>
    <param name="listen-ip" value="$${local_ip_v4}"/>
    <param name="listen-port" value="8021"/>
    <param name="password" value="ClueCon"/>
    <param name="apply-inbound-acl" value="0.0.0.0/0"/>
    <param name="apply-register-acl" value="0.0.0.0/0"/>
    <param name="apply-proxy-acl" value="0.0.0.0/0"/>
  </settings>
</configuration>

<configuration name="sofia.conf">
  <global_settings>
    <param name="log-level" value="9"/>
    <param name="debug-presence" value="0"/>
  </global_settings>
  <profiles>
    <profile name="webrtc">
      <domains>
        <domain name="$${domain}"/>
      </domains>
      <settings>
        <param name="context" value="webrtc"/>
        <param name="sip-port" value="5060"/>
        <param name="tls-sip-port" value="5080"/>
        <param name="dialplan" value="XML"/>
        <param name="sip-ip" value="$${local_ip_v4}"/>
        <param name="rtp-ip" value="$${local_ip_v4}"/>
        <param name="ws-binding" value=":5071"/>
        <param name="wss-binding" value=":5081"/>
        <param name="tls" value="true"/>
        <param name="tls-only" value="false"/>
        <param name="tls-bind-params" value="transport=tls"/>
        <param name="codec-prefs" value="OPUS@8000h"/>
        <param name="codec-negotiation" value="greedy"/>
        <param name="disable-transcoding" value="true"/>
        <param name="apply-candidate-acl" value="localnet.auto"/>
        <!-- fix webrtc audio latency problem -->
        <param name="rtp-timer-name" value="soft"/>
      </settings>
    </profile>
  </profiles>
</configuration>

</section>

<section name="dialplan">
  <context name="webrtc">
    <extension name="webrtc">
      <condition field="destination_number" expression="^(0000)$">
        <action application="answer"/>
        <action application="set" data="playback_sleep_val=0"/>
        <action application="sched_hangup" data="+60 NORMAL_CLEARING"/>
        <action application="endless_playback" data="background_8k.wav"/>
        <action application="hangup"/>
      </condition>
    </extension>
  </context>
</section>

<section name="directory">
  <domain name="local">
    <params>
      <param name="dial-string" value="${sofia_contact(${dialed_user}@${dialed_domain})}"/>
    </params>
    <groups>
      <group name="all">
        <users>
          <user id="101"><params><param name="password" value="101"/></params></user>
        </users>
      </group>
    </groups>
  </domain>
</section>

</document>
